(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{2070:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(292)}])},3851:function(e,t,r){"use strict";var s=r(5893);r(7294),r(1664),r(7498),r(9332),t.Z=function(){return(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"container-fluid p-3 mb-2 bg-dark-subtle text-dark text-center",children:"Inventory Controller"}),(0,s.jsxs)("div",{className:"Container-flex",children:[(0,s.jsx)("div",{className:"col-md"}),(0,s.jsx)("div",{className:"col-md text-center",children:(0,s.jsx)("img",{height:"125",width:"125",className:"mx-auto pb-2",src:"https://cdn.pixabay.com/photo/2021/11/22/22/53/inventory-6817561_1280.png"})}),(0,s.jsx)("div",{className:"col-md"})]})]})}},292:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(5893),a=r(9332),n=r(7294),o=r(7498),i=r(7311);function c(e){this.message=e}c.prototype=Error(),c.prototype.name="InvalidCharacterError";var l="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new c("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,a=0,n=0,o="";s=t.charAt(n++);~s&&(r=a%4?64*r+s:s,a++%4)&&(o+=String.fromCharCode(255&r>>(-2*a&6))))s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);return o};function u(e){this.message=e}u.prototype=Error(),u.prototype.name="InvalidTokenError";var d=function(e,t){if("string"!=typeof e)throw new u("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t,r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw"Illegal base64url string!"}try{return t=r,decodeURIComponent(l(t).replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return l(r)}}(e.split(".")[r]))}catch(e){throw new u("Invalid token specified: "+e.message)}},h=r(3851),p=function(){let e=(0,a.useRouter)(),{state:t,dispatch:r}=(0,o.j)(),[c,l]=(0,n.useState)(""),[u,p]=(0,n.useState)(""),[m,f]=(0,n.useState)("");return(0,s.jsxs)("div",{children:[(0,s.jsx)(h.Z,{}),(0,s.jsx)("div",{className:"flex",children:(0,s.jsxs)("form",{onSubmit:function(t){t.preventDefault(),i.Z.login(c,u,m).then(async t=>{console.log(t);let s=d(t.access);await r({currentUserToken:t.access,currentUser:s}),e.push("/dashboard")})},className:"mx-auto my-auto border-2 bg-mtgray",children:[(0,s.jsxs)("div",{className:"flex justify-between m-2 items-center space-x-2",children:[(0,s.jsx)("label",{htmlFor:"username",children:"Username:"}),(0,s.jsx)("input",{className:"border",type:"text",id:"username",name:"username",autoComplete:"current-username",onChange:e=>f(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"flex justify-between m-2 items-center space-x-2",children:[(0,s.jsx)("label",{htmlFor:"email",children:"Email:"}),(0,s.jsx)("input",{className:"border",type:"text",id:"email",name:"email",onChange:e=>l(e.target.value),required:!0})]}),(0,s.jsxs)("div",{className:"flex justify-between m-2 items-center space-x-2",children:[(0,s.jsx)("label",{htmlFor:"pass",children:"Password"}),(0,s.jsx)("input",{className:"border",type:"password",id:"pass",name:"password",minLength:"8",autoComplete:"current-password",required:!0,onChange:e=>p(e.target.value)})]}),(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)("input",{className:"bg-mtpurple text-white py-2 px-4 rounded-lg mx-auto my-2 font-bold disabled:opacity-60",type:"submit",value:"Sign in"})})]})})]})}},3496:function(e,t,r){"use strict";function s(){let e=JSON.parse(localStorage.getItem("user"));return e&&e.access?{Authorization:"Bearer "+e.access}:{}}r.d(t,{Z:function(){return s}})},7311:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});let s="http://127.0.0.1:8000/",a="token/refresh/";var n=r(6154),o=r(3496);let i=n.Z.create({baseURL:s});i.interceptors.response.use(e=>e,e=>{let t=e.config;if(401===e.response.status&&t.url===s+a)return window.location.href="/login/",Promise.reject(e);if("token_not_valid"===e.response.data.code&&401===e.response.status&&"Unauthorized"===e.response.statusText){let e=localStorage.getItem("user");if(e){let r=JSON.parse(atob(e.refresh.split(".")[1])),s=Math.ceil(Date.now()/1e3);if(console.log(r.exp),r.exp>s)return i.post(a,{refresh:e.refresh}).then(e=>(localStorage.setItem("user",e.data),i.defaults.headers.Authorization="Bearer "+e.data.access,t.headers.Authorization="Bearer "+e.data.access,i(t))).catch(e=>{console.log(e)});console.log("Refresh token is expired",r.exp,s),window.location.href="/login/"}else console.log("Refresh token not available."),window.location.href="/login/"}return Promise.reject(e)});var c=e=>i({...e,headers:(0,o.Z)()}).then(e=>(console.debug("Request Successful!",e),e)).catch(e=>(console.error("Request Failed:",e.config),e.response?(console.error("Status:",e.response.status),console.error("Data:",e.response.data),console.error("Headers:",e.response.headers)):console.error("Error Message:",e.message),Promise.reject(e.response||e.message)));r(1876);var l=new class{async login(e,t,r){try{let s=await c({url:"user/login/",method:"POST",data:{email:e,password:t,username:r}});if(s.data.access)return this.setToken(s)}catch(e){return e.response}}logout(){localStorage.removeItem("user")}async register(e){let{username:t,email:r,password:s,firstName:a,lastName:n,image:o}=e;try{await c({url:"user/signup/",method:"POST",data:{username:t,email:r,password:s,first_name:a,last_name:n,image:o}}),await this.login(r,s,t)}catch(e){return e.response}}setToken(e){return localStorage.setItem("user",JSON.stringify(e.data)),e.data}async refreshToken(){try{let e=JSON.parse(localStorage.getItem("user"));if(e.refresh){let t=await c({url:a,method:"POST",data:{refresh:e.refresh}});return t.data}}catch(e){return e.response}}constructor(){this.login=this.login.bind(this)}}}},function(e){e.O(0,[316,63,774,888,179],function(){return e(e.s=2070)}),_N_E=e.O()}]);